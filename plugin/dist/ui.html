<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Web to Figma Converter</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 12px;
      padding: 16px;
      background: #ffffff;
      color: #000000;
    }
    
    .container {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    h1 {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .subtitle {
      font-size: 11px;
      color: #666;
      margin-bottom: 12px;
    }
    
    label {
      display: block;
      font-weight: 500;
      margin-bottom: 6px;
      font-size: 11px;
      color: #333;
    }
    
    input[type="text"],
    input[type="url"],
    select {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 12px;
      font-family: inherit;
    }
    
    input:focus,
    select:focus {
      outline: none;
      border-color: #18a0fb;
    }
    
    .mode-selector {
      display: flex;
      gap: 8px;
      margin-top: 4px;
    }
    
    .mode-option {
      flex: 1;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      text-align: center;
      cursor: pointer;
      font-size: 11px;
      transition: all 0.2s;
    }
    
    .mode-option:hover {
      border-color: #18a0fb;
      background: #f5f5f5;
    }
    
    .mode-option.selected {
      border-color: #18a0fb;
      background: #18a0fb;
      color: white;
    }
    
    .mode-description {
      font-size: 10px;
      color: #666;
      margin-top: 2px;
    }
    
    button {
      width: 100%;
      padding: 10px;
      background: #18a0fb;
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }
    
    button:hover {
      background: #0d8ce8;
    }
    
    button:active {
      background: #0b7dd4;
    }
    
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    
    .status {
      padding: 8px;
      border-radius: 4px;
      font-size: 11px;
      text-align: center;
      display: none;
    }
    
    .status.info {
      background: #e8f4fd;
      color: #0d8ce8;
      border: 1px solid #b3d9f7;
    }
    
    .status.success {
      background: #e8f9f1;
      color: #0d8c4d;
      border: 1px solid #b3e8d0;
    }
    
    .status.error {
      background: #fde8e8;
      color: #d40d0d;
      border: 1px solid #f7b3b3;
    }
    
    .progress-bar {
      width: 100%;
      height: 4px;
      background: #f0f0f0;
      border-radius: 2px;
      overflow: hidden;
      display: none;
      margin-top: 8px;
    }
    
    .progress-bar-fill {
      height: 100%;
      background: #18a0fb;
      transition: width 0.3s;
      width: 0%;
    }
    
    .examples {
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid #eee;
    }
    
    .example-title {
      font-size: 11px;
      font-weight: 500;
      color: #666;
      margin-bottom: 6px;
    }
    
    .example-link {
      display: block;
      padding: 6px;
      background: #f5f5f5;
      border-radius: 3px;
      text-decoration: none;
      color: #333;
      font-size: 10px;
      margin-bottom: 4px;
      transition: background 0.2s;
    }
    
    .example-link:hover {
      background: #e8e8e8;
    }
    
    .feature-list {
      font-size: 10px;
      color: #666;
      padding-left: 16px;
      margin-top: 8px;
    }
    
    .feature-list li {
      margin-bottom: 4px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div>
      <h1>üé® Web to Figma Converter</h1>
      <div class="subtitle">Final Version - 95-100% Accuracy</div>
    </div>
    
    <div>
      <label for="url">Website URL</label>
      <input 
        type="url" 
        id="url" 
        placeholder="https://example.com" 
        value="https://stripe.com"
      />
    </div>
    
    <div>
      <label>Extraction Mode</label>
      <div class="mode-selector">
        <div class="mode-option" data-mode="basic">
          <div>Basic</div>
          <div class="mode-description">Fast</div>
        </div>
        <div class="mode-option selected" data-mode="hybrid">
          <div>Hybrid ‚≠ê</div>
          <div class="mode-description">Balanced</div>
        </div>
        <div class="mode-option" data-mode="maximum">
          <div>Maximum</div>
          <div class="mode-description">Perfect</div>
        </div>
      </div>
    </div>
    
    <button id="import-btn">Import Website</button>
    
    <div class="progress-bar" id="progress-bar">
      <div class="progress-bar-fill" id="progress-fill"></div>
    </div>
    
    <div class="status" id="status"></div>
    
    <div class="examples">
      <div class="example-title">Quick Test Sites:</div>
      <a href="#" class="example-link" data-url="https://stripe.com">Stripe - Effects Test</a>
      <a href="#" class="example-link" data-url="https://tailwindcss.com">Tailwind - Layout Test</a>
      <a href="#" class="example-link" data-url="https://github.com">GitHub - Typography Test</a>
    </div>
    
    <div class="examples">
      <div class="example-title">‚ú® Features:</div>
      <ul class="feature-list">
        <li>‚úì Font extraction & mapping</li>
        <li>‚úì Element screenshots</li>
        <li>‚úì Advanced gradients & effects</li>
        <li>‚úì Auto-layout support</li>
        <li>‚úì Design tokens</li>
        <li>‚úì 95-100% accuracy</li>
      </ul>
    </div>
  </div>
  
  <script>
    const urlInput = document.getElementById('url');
    const importBtn = document.getElementById('import-btn');
    const statusDiv = document.getElementById('status');
    const progressBar = document.getElementById('progress-bar');
    const progressFill = document.getElementById('progress-fill');
    const modeOptions = document.querySelectorAll('.mode-option');
    const exampleLinks = document.querySelectorAll('.example-link');
    
    let selectedMode = 'hybrid';
    
    // Mode selection
    modeOptions.forEach(option => {
      option.addEventListener('click', () => {
        modeOptions.forEach(o => o.classList.remove('selected'));
        option.classList.add('selected');
        selectedMode = option.dataset.mode;
      });
    });
    
    // Example link clicks
    exampleLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        urlInput.value = link.dataset.url;
      });
    });
    
    // Import button
    importBtn.addEventListener('click', async () => {
      const url = urlInput.value.trim();
      
      if (!url) {
        showStatus('Please enter a URL', 'error');
        return;
      }
      
      if (!url.startsWith('http://') && !url.startsWith('https://')) {
        showStatus('URL must start with http:// or https://', 'error');
        return;
      }
      
      importBtn.disabled = true;
      importBtn.textContent = 'Importing...';
      progressBar.style.display = 'block';
      progressFill.style.width = '0%';
      showStatus('Connecting to scraper...', 'info');
      
      // Connect via WebSocket
      try {
        const ws = new WebSocket('ws://localhost:3000/ws');
        
        ws.onopen = () => {
          showStatus(`Extracting ${url} in ${selectedMode} mode...`, 'info');
          progressFill.style.width = '10%';
          ws.send(JSON.stringify({ url, mode: selectedMode }));
        };
        
        ws.onmessage = (event) => {
          const message = JSON.parse(event.data);
          
          switch (message.type) {
            case 'full_page':
              progressFill.style.width = '90%';
              parent.postMessage({ 
                pluginMessage: { type: 'full_page', data: message.data } 
              }, '*');
              break;
              
            case 'tokens':
              progressFill.style.width = '20%';
              parent.postMessage({ 
                pluginMessage: { type: 'tokens', data: message.data } 
              }, '*');
              break;
              
            case 'node_chunk':
              if (message.progress) {
                const percent = (message.progress.current / message.progress.total * 70) + 20;
                progressFill.style.width = percent + '%';
                showStatus(
                  `Importing nodes: ${message.progress.current}/${message.progress.total}`, 
                  'info'
                );
              }
              parent.postMessage({ 
                pluginMessage: { type: 'node_chunk', data: message.data } 
              }, '*');
              break;
              
            case 'complete':
              progressFill.style.width = '100%';
              showStatus('‚úì Import complete!', 'success');
              setTimeout(() => {
                importBtn.disabled = false;
                importBtn.textContent = 'Import Website';
                progressBar.style.display = 'none';
              }, 2000);
              ws.close();
              break;
              
            case 'error':
              showStatus('Error: ' + message.error, 'error');
              importBtn.disabled = false;
              importBtn.textContent = 'Import Website';
              progressBar.style.display = 'none';
              ws.close();
              break;
          }
        };
        
        ws.onerror = () => {
          showStatus('Connection failed. Is the server running?', 'error');
          importBtn.disabled = false;
          importBtn.textContent = 'Import Website';
          progressBar.style.display = 'none';
        };
        
        ws.onclose = () => {
          if (importBtn.disabled) {
            showStatus('Connection closed', 'error');
            importBtn.disabled = false;
            importBtn.textContent = 'Import Website';
            progressBar.style.display = 'none';
          }
        };
        
      } catch (error) {
        showStatus('Failed to connect: ' + error.message, 'error');
        importBtn.disabled = false;
        importBtn.textContent = 'Import Website';
        progressBar.style.display = 'none';
      }
    });
    
    function showStatus(message, type) {
      statusDiv.textContent = message;
      statusDiv.className = 'status ' + type;
      statusDiv.style.display = 'block';
    }
    
    // Listen for messages from plugin
    window.onmessage = (event) => {
      const message = event.data.pluginMessage;
      if (message.type === 'import_complete') {
        showStatus('‚úì All nodes created in Figma!', 'success');
      }
    };
  </script>
</body>
</html>
